<!DOCTYPE html>
<html>
<head>
  <title>Answer Time Counter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
</head>
<body
  style="
    padding: 2rem;
    text-align: center;
  "
>
  <h1>Answer Time Counter</h1>
  <br />
  
  <h2>Start Point:</h2>
  <p id="el-start-point">
    <input
      id="el-start-point-input"
      type="datetime-local"
      min="2023-01-01T00:00"
      max="2024-01-01T00:00"
    />
  </p>
  
  <h2>Time Passed:</h2>
  <p id="el-time-passed"></p>

  <h2>Min Wait:</h2>
  <p id="el-min-wait">
    <input id="el-min-wait-input" type="number" min="0" max="90" /> days
  </p>

  <h2>Min Wait Point:</h2>
  <p id="el-min-wait-date"></p>

  <h2>Left before that:</h2>
  <p id="el-time-left"></p>
  <script>
    document.addEventListener("DOMContentLoaded", function(event) {
      const DATE_FORMAT = "dddd, MMMM Do YYYY, h:mm:ss a";

      const DEFAULTS = {
        startDate: new Date("2023-06-12T16:39:00+00:00"), // June 12th, 12:39pm EST
        minWaitDays: 37
      };

      const ELEMENTS = {
        startInput: document.getElementById("el-start-point-input"),
        minWaitDaysInput: document.getElementById("el-min-wait-input"),
        minWaitDate: document.getElementById("el-min-wait-date"),
        startTimePassed: document.getElementById("el-time-passed"),
        minWaitTimeLeft: document.getElementById("el-time-left")
      };

      ELEMENTS.startInput.value = toDatetimeLocal(DEFAULTS.startDate);
      ELEMENTS.minWaitDaysInput.value = DEFAULTS.minWaitDays;

      // Function to calculate time difference in days, hours, minutes, and seconds
      function getTimeDifference(startDate, endDate) {
        const diff = endDate - startDate;
        let timeDiff = {};

        timeDiff.days = Math.floor(diff / (1000 * 60 * 60 * 24));
        timeDiff.hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        timeDiff.minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        timeDiff.seconds = Math.floor((diff % (1000 * 60)) / 1000);

        return timeDiff;
      }

      // calculate and set clocks:
      updateCounters();

      // Function to update the time counters
      function updateCounters() {
        const currentTime = new Date();

        const timePassed = getTimeDifference(new Date(ELEMENTS.startInput.value), currentTime);
        ELEMENTS.startTimePassed.textContent = `${timePassed.days} days, ${timePassed.hours} hours, ${timePassed.minutes} minutes, ${timePassed.seconds} seconds`;

        const timeLeft = getTimeDifference(currentTime, calculateMinWaitDatetime());
        ELEMENTS.minWaitTimeLeft.textContent = `${timeLeft.days} days, ${timeLeft.hours} hours, ${timeLeft.minutes} minutes, ${timeLeft.seconds} seconds`;

        // Update the counters every second
        setTimeout(updateCounters, 1000);
      }

       function toDatetimeLocal(date) {
          const ten = function (i) {
              return (i < 10 ? '0' : '') + i;
            },
            YYYY = date.getFullYear(),
            MM = ten(date.getMonth() + 1),
            DD = ten(date.getDate()),
            HH = ten(date.getHours()),
            II = ten(date.getMinutes()),
            SS = ten(date.getSeconds())
          ;

          return YYYY + '-' + MM + '-' + DD + 'T' + HH + ':' + II + ':' + SS;
        }

      function calculateMinWaitDatetime() {
        const MIN_WAIT_DATETIME = moment(ELEMENTS.startInput.value)
          .add(ELEMENTS.minWaitDaysInput.value, "days")
          .utcOffset(0)
          .set("hour", 13)
          .set("minute", 0)
          .set("second", 0)
          .set("millisecond", 0)
          .toDate();

        ELEMENTS.minWaitDate.textContent = moment(MIN_WAIT_DATETIME).format(DATE_FORMAT);

        return MIN_WAIT_DATETIME;
      }
    });
  </script>
</body>
</html>
